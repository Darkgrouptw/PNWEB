<script src="/js/queryToggle.js"></script>
<% def ListItems() %>
    <% index = 0 %>
	<% @items.each do |item|%>
        <div class="BoxSpace" tree_id="<%= item.id %>" title="<%="NPWEB-"+@issue_info[index].title%>" description="<%= "ç·¨è€…ï¼š" + @nicknames[index] %>">
            <!-- è¢«é¸åˆ°æ™‚ï¼Œæœƒæœ‰ Border -->
            <div class="BoxSelectBorder" <% if index != 0 %> style = "display:none" <% end %>>
            </div>
            
            <!-- æ–‡å­—æ¡†æ¡† -->
            <div class="BoxText">
                <div class="BoxTitle">
                    <%= @issue_info[index].title %>
                </div>
                <div id="shareBtn" class="btn btn-success BoxShare" >Share</div>
                <!-- æŒ‰è´Š button -->
                <% if current_user != nil %>
                    <% if !@hasThumpAlready[index] %>
                        <a href="/TreeThumbUp?id=<%= item.id.to_s + @addLink %>" class="btn btn-primary BoxThumbUp">æŒ‰è®šğŸ‘</a>
                    <% else %>
                        <a href="/TreeThumbUp?id=<%= item.id.to_s + @addLink %>" class="btn btn-info disabled BoxThumbUp">å·²è®šé</a>
                    <% end %>
                <% else %>
                    <a href="/TreeThumbUp?id=<%= item.id.to_s + @addLink %>" class="btn btn-info disabled BoxThumbUp">è«‹ç™»å…¥</a>
                <% end %>
                
                <!-- å…§å®¹åç¨± -->
                <div class="BoxContent">
                    <%= @issue_info[index].post %>
                </div>
                
                <!-- äººç‰© -->
                <div class="BoxPeople">
                    ç·¨è€…ï¼š<%= @nicknames[index] %>
                </div>
                
                <!-- æ—¥æœŸ -->
                <div class="BoxDateInfo">
                    ä¸Šç·šæ™‚é–“ï¼š<%= @createTimeArray[index] %>
                    <br>
                    æœ€å¾Œæ›´æ–°ï¼š<%= @updateTimeArray[index] %>
                </div>
                
                <!-- è´Šæ•¸ -->
                <div class="BoxOtherInfo">
                    è®šæ•¸ï¼š <%= @up[index] %> 
                </div>
            </div>
            <% index += 1 %>
        </div>
    <% end %>
<% end %>
<!-- å‰é¢çš„å®£å‘Š -->
<link rel="stylesheet" type="text/css" href="/css/Tree/index.css">
<link rel="stylesheet" type="text/css" href="/css/query.css">
<script src="js/Tree/TreeIndex.js"></script>
<script src="/js/queryIssue.js"></script>
<script src="/js/queryIssue2.js"></script>
<% if !@tree.nil? %>
    <% content_for :title, "NPWEB-" + @issue.title %>
    <% x = "ç·¨è€…ï¼š" + @user.nickname %>
    <% content_for :description, x.to_s%>
<% end %>


<!-- å·¦é‚ŠCanvas -->
<div class="LeftCanvas">
    <% if current_user !=nil and current_user.level >=2 %>
        <div class="AddNodeButton">
            <button class="btn btn-warning" id="addRoot">æ–°å¢è­°é¡Œæ¨¹</button>
        </div>
    <% end %>

    <!-- ä¾ç…§ä»€éº¼æ’åº -->
    <div class="dropdown TreeOrderByList">
        <% orderByName= "è¿‘æœŸäººæ°£" %>
        <% if @OrderBy == 0.to_s %>
            <% orderByName = "è¿‘æœŸäººæ°£"%>
        <% elsif @OrderBy == 1.to_s %>
            <% orderByName = "æœ€æ–°"%>
        <% elsif @OrderBy == 2.to_s %>
            <% orderByName = "æ­·å²äººæ°£"%>
        <% end %>
            
        
        <% # å¦‚æœæœ‰æœå°‹æ±è¥¿çš„è©±ï¼Œéœ€è¦å†é€£çµå¾Œé¢åŠ ä¸Šé¡å¤–çš„åƒæ•¸ %>
        <% if @searchParams != "" %>
            <% addLink = "&search=" + @searchParams %>
        <% else %>
            <% addLink = "" %>
        <% end %>
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">ä¾ç…§ <%= orderByName %> æ’åº
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
            <% link = treeindex_path(OrderBy: 0) %>
            <li><a href= <%= link + addLink %> >è¿‘æœŸäººæ°£æ’åº</a></li>
            <% link = treeindex_path(OrderBy: 1) %>
            <li><a href= <%= link + addLink %> >æœ€æ–°æ’åº</a></li>
            <% link = treeindex_path(OrderBy: 2) %>
            <li><a href= <%= link + addLink %> >æ­·å²äººæ°£æ’åº</a></li>
        </ul>
    </div>
    
    <!-- æœå°‹çš„ DIV -->
    <div class="TreeIndexSearch">
        <input type="text" class="form-control" placeholder="æœå°‹è­°é¡Œæ¨¹" id="queryIssue2"  value="<%= @searchParams %>">
    </div>
    <span class="input-group-btn TreeIndexSearchButton">
        <button class="btn btn-default" type="button" id="TreeIndexSearch">
            <span class="glyphicon glyphicon-search"></span>
        </button>
    </span>
    <div id="queryIssueDiv2" class="queryDiv TreeSearchDIV" style="width: 350px; display: none;"></div>
    
    <div class="TreeList">
        <% ListItems() %>
    </div>
</div>

<!-- å³é‚Šçš„ -->
<% if @items != nil && @items.length > 0 %>
    <iframe class="RightCanvas" src="/TreeCanvas?id=<%= @items[0].id %>" frameBorder="0"></iframe>
<% else %>
    <iframe class="RightCanvas" src="/TreeCanvas" frameBorder="0"></iframe>
<% end %>

<!-- å¦‚æœè¦–çª— Size å°æ–¼æŸå€‹å€¼ï¼Œæœƒé¡¯ç¤ºå°æ–¼é è¨­è¦–çª— -->
<div class="WindowSizeWarning" style="display: none;">
    <div>
        <h3>æ³¨æ„ï¼ï¼</h3>
        ç”±æ–¼è¦–çª—å¤ªå°å°æ–¼é è¨­çš„ç¯„åœ (1600 x 900)ï¼Œæ‰€ä»¥æœ‰äº›æ±è¥¿æœƒå› ç‚ºæ’ç‰ˆï¼Œè€Œå°è‡´å¯èƒ½æœƒçœ‹ä¸åˆ°ã€‚
        <button class="btn btn-primary">äº†è§£</button>
    </div>
</div>

<!-- åŠ  Root çš„é» -->
<div class="AddRoot" style="display: none;">
    <div class="AddRootBox">
        <span class="glyphicon glyphicon-remove" id="RemoveAddRoot"></span>
        
        <div class="input-group">
            <div class="AddRootTitle">
                æ–°å¢çš„ Root åç¨±ï¼š
            </div>
            
            <input type="text" class="form-control" placeholder="è«‹è¼¸å…¥è­°é¡Œ" name="IssueName" id="queryIssue">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button" id="addRootBtn">
                    <span class="glyphicon glyphicon-plus"></span>
                </button>
            </span>
        </div>
        <div id="queryIssueDiv" class="queryDiv" style="width: 350px; display: none;"></div>
    </div>
</div>

<script>
document.getElementById('shareBtn').onclick = function() {
  FB.ui({
    method: 'share',
    display: 'popup',
    href: $('meta[property="og\:url"]').contents();,
  }, function(response){});
}
</script>