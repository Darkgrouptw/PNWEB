<% if @me == nil %>
	<div class = "whiteText">
		error,invalid parameter
	</div>
<% else %>
	<div class = "whiteText">
		<%= @tags %>
		<!-- find the root issue-->
		<% temp_issue = @me %>
		<% while temp_issue.trunk_id != -1 %>
			<!-- 所有根議題的點閱率都加一 -->
			<% temp_issue.popularity = temp_issue.popularity + 1 %>
			<% temp_issue.update(popularity: temp_issue.popularity) %>
			<% temp_issue =@issues.where(id: temp_issue.trunk_id)[0] %>
		<% end %>
		<% temp_issue.popularity = temp_issue.popularity + 1 %>
		<% temp_issue.update(popularity: temp_issue.popularity) %>
		<div class = "col-md-2">
			<!-- Tree iterative-->
			<%	def runTree(issue) %>
				<div> 
					<%	@issues.where(trunk_id: issue.id).each do |sub_issue| %> 
						<blockquote>
							<% if sub_issue.id.to_s == @tags %>
								<%= sub_issue.title %>
							<% else %>
								<% link = "/Issuelist/" + sub_issue.id.to_s %>
								<a href = <%= link %> >
									<%= sub_issue.title %>
								</a>
							<% end %>
							<% runTree(sub_issue) %>
						</blockquote>
					<% end %>
				</div>
			<%	end %>
			<!-- 產生Tree -->
			<div>
				<% if temp_issue.id.to_s == @tags %>
					<%= temp_issue.title %>
				<% else %>
					<% link = "/Issuelist/" + temp_issue.id.to_s %>
					<a href = <%= link %> >
						<%= temp_issue.title %>
					</a>
				<% end %>
					<% runTree(temp_issue) %>
			</div>
		</div>

		<div class = "col-md-10">
			<!-- title -->
			<table class = "table">
				<thead>
					<tr align = "center"><td class = "col-md-8" colspan = "2"><%= @me.title %></td></tr>
				</thead>
				<tbody>
					<tr>
						<td class = "col-md-7"><%= @me.post %></td>
						<td class = "col-md-1"><%= link_to("add detail",class: "btn") %></td>
					</tr>
				</tbody>
			</table>
			<!-- support detail -->
			
		</div>
	</div>


<% end %>
